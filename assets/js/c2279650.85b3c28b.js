"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[828],{3905:function(n,t,e){e.d(t,{Zo:function(){return p},kt:function(){return m}});var i=e(7294);function a(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function r(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,i)}return e}function c(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?r(Object(e),!0).forEach((function(t){a(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):r(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function l(n,t){if(null==n)return{};var e,i,a=function(n,t){if(null==n)return{};var e,i,a={},r=Object.keys(n);for(i=0;i<r.length;i++)e=r[i],t.indexOf(e)>=0||(a[e]=n[e]);return a}(n,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(i=0;i<r.length;i++)e=r[i],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(n,e)&&(a[e]=n[e])}return a}var h=i.createContext({}),o=function(n){var t=i.useContext(h),e=t;return n&&(e="function"==typeof n?n(t):c(c({},t),n)),e},p=function(n){var t=o(n.components);return i.createElement(h.Provider,{value:t},n.children)},u={inlineCode:"code",wrapper:function(n){var t=n.children;return i.createElement(i.Fragment,{},t)}},g=i.forwardRef((function(n,t){var e=n.components,a=n.mdxType,r=n.originalType,h=n.parentName,p=l(n,["components","mdxType","originalType","parentName"]),g=o(e),m=a,s=g["".concat(h,".").concat(m)]||g[m]||u[m]||r;return e?i.createElement(s,c(c({ref:t},p),{},{components:e})):i.createElement(s,c({ref:t},p))}));function m(n,t){var e=arguments,a=t&&t.mdxType;if("string"==typeof n||a){var r=e.length,c=new Array(r);c[0]=g;var l={};for(var h in t)hasOwnProperty.call(t,h)&&(l[h]=t[h]);l.originalType=n,l.mdxType="string"==typeof n?n:a,c[1]=l;for(var o=2;o<r;o++)c[o]=e[o];return i.createElement.apply(null,c)}return i.createElement.apply(null,e)}g.displayName="MDXCreateElement"},8582:function(n,t,e){e.r(t),e.d(t,{frontMatter:function(){return l},contentTitle:function(){return h},metadata:function(){return o},toc:function(){return p},default:function(){return g}});var i=e(7462),a=e(3366),r=(e(7294),e(3905)),c=["components"],l={},h="Map of the territory",o={unversionedId:"book/map-of-the-territory",id:"book/map-of-the-territory",title:"Map of the territory",description:"Gi\u1edbi thi\u1ec7u v\u1ec1 c\xe1c kh\xe1i ni\u1ec7m c\u0103n b\u1ea3n, c\xe1c giai \u0111o\u1ea1n th\u1ef1c thi c\u1ee7a compiler.",source:"@site/../grox-docs/target/mdoc/book/map-of-the-territory.md",sourceDirName:"book",slug:"/book/map-of-the-territory",permalink:"/grox/docs/book/map-of-the-territory",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/../grox-docs/target/mdoc/book/map-of-the-territory.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"lox-language",permalink:"/grox/docs/book/lox-language"},next:{title:"Scanning",permalink:"/grox/docs/book/scanning"}},p=[{value:"The Parts of a Language",id:"the-parts-of-a-language",children:[{value:"Scanning",id:"scanning",children:[],level:3},{value:"Parsing",id:"parsing",children:[],level:3},{value:"Static analysis",id:"static-analysis",children:[{value:"Notes",id:"notes",children:[],level:4}],level:3},{value:"Intermediate Representation",id:"intermediate-representation",children:[],level:3},{value:"Optimization",id:"optimization",children:[],level:3},{value:"Code generation",id:"code-generation",children:[],level:3},{value:"Virtual machine",id:"virtual-machine",children:[],level:3},{value:"Runtime",id:"runtime",children:[],level:3}],level:2},{value:"Shortcut and alternative routes",id:"shortcut-and-alternative-routes",children:[{value:"Single-pass compilers",id:"single-pass-compilers",children:[],level:3},{value:"Tree-walk interpreters",id:"tree-walk-interpreters",children:[],level:3},{value:"Transpiler",id:"transpiler",children:[],level:3},{value:"Just-in-time compilation",id:"just-in-time-compilation",children:[],level:3}],level:2},{value:"Compilers vs Interpreters",id:"compilers-vs-interpreters",children:[],level:2}],u={toc:p};function g(n){var t=n.components,e=(0,a.Z)(n,c);return(0,r.kt)("wrapper",(0,i.Z)({},u,e,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"map-of-the-territory"},"Map of the territory"),(0,r.kt)("p",null,"Gi\u1edbi thi\u1ec7u v\u1ec1 c\xe1c kh\xe1i ni\u1ec7m c\u0103n b\u1ea3n, c\xe1c giai \u0111o\u1ea1n th\u1ef1c thi c\u1ee7a compiler."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#the-parts-of-a-language"},"The Parts of a Language"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#scanning"},"Scanning/Lexing")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#parsing"},"Parsing")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#static-analysis"},"Static analysis")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#intermediate-representation"},"Intermediate representations")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#optimization"},"Optimization")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#code-generation"},"Code Generation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#virtual-machine"},"Virtual Machine")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#runtime"},"Runtime")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#shortcut-and-alternative-routes"},"Shortcut and alternative routes"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#single-pass-compilers"},"Single-pass compilers")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#tree-walk-interpreters"},"Tree-walk interpreters")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#transpiler"},"Transpiler")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#just-in-time-compilation"},"Just-in-time compilation")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#compilers-vs-interpreters"},"Compilers vs interpreters"))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/875BQl5.png",alt:"The Map"})),(0,r.kt)("h2",{id:"the-parts-of-a-language"},"The Parts of a Language"),(0,r.kt)("h3",{id:"scanning"},"Scanning"),(0,r.kt)("p",null,"C\xf2n \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 lexing ho\u1eb7c lexical analysis. M\u1ed9t scanner (ho\u1eb7c lexer) nh\u1eadn m\u1ed9t string v\xe0 chia nh\u1ecf n\xf3 th\xe0nh m\u1ed9t chu\u1ed7i c\u1ee7a token."),(0,r.kt)("p",null,'Tokens c\xf3 th\u1ec3 coi nh\u01b0 "t\u1eeb" v\xe0 d\u1ea5u c\xe2u, \u0111\u01b0\u1ee3c d\xf9ng \u0111\u1ec3 t\u1ea1o n\xean ng\u1eef ph\xe1p c\u1ee7a m\u1ed9t ng\xf4n ng\u1eef.\n',(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/ETU1ZVC.png",alt:"ex1"})),(0,r.kt)("p",null,"Fun fact: ",(0,r.kt)("strong",{parentName:"p"},"Lexical")," comes from the Greek root ",(0,r.kt)("strong",{parentName:"p"},"lex"),", meaning ",(0,r.kt)("strong",{parentName:"p"},"word")),(0,r.kt)("h3",{id:"parsing"},"Parsing"),(0,r.kt)("p",null,"Parsers c\xf3 \u0111\u1ea7u v\xe0o l\xe0 m\u1ed9t chu\u1ed7i token v\xe0 tr\u1ea3 v\u1ec1 m\u1ed9t c\u1ea5u tr\xfac d\u1eef li\u1ec7u ki\u1ec3u c\xe2y th\u01b0\u1eddng \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 parse tree ho\u1eb7c abstract syntax tree(AST) ho\u1eb7c syntax trees. Th\xeam v\xe0o \u0111\xf3 parsers c\xf2n c\xf3 nhi\u1ec7m v\u1ee5 th\xf4ng b\xe1o c\xe1c l\u1ed7i ng\u1eef ph\xe1p (syntax error) cho ng\u01b0\u1eddi d\xf9ng."),(0,r.kt)("p",null,"\u0110\u1ed1i chi\u1ebfu v\u1edbi c\xe1c ng\xf4n ng\u1eef n\xf3i th\xec, scanner s\u1ebd chia nh\u1ecf m\u1ed9t \u0111o\u1ea1n v\u0103n th\xe0nh t\u1eebng t\u1eeb, d\u1ea5u c\xe2u; c\xf2n parser s\u1ebd d\u1ef1a v\xe0o \u0111\xf3 m\xe0 ph\xe2n t\xedch ng\u1eef ph\xe1p c\u1ea3 \u0111o\u1ea1n v\u0103n."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/26k6LOJ.png",alt:"AST"})),(0,r.kt)("h3",{id:"static-analysis"},"Static analysis"),(0,r.kt)("p",null,"D\u1ef1a v\xe0o ASTs t\u1eeb giai \u0111o\u1ea1n tr\u01b0\u1edbc, ph\u1ea7n n\xe0y s\u1ebd l\xe0m nh\u1eefng c\xf4ng vi\u1ec7c sau:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"binding/resolution"),": v\u1edbi m\u1ed7i \u0111\u1ecbnh danh(identifier; vd: t\xean bi\u1ebfn ho\u1eb7c t\xean h\xe0m), ch\xfang ta c\u1ea7n t\xecm n\u01a1i n\xf3 \u0111\u1ecbnh ngh\u0129a, n\u01a1i n\xf3 \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng; ph\u1ea1m vi(scope) h\u1ee3p l\u1ec7 c\u1ee7a n\xf3."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"type checking"),": n\u1ebfu m\u1ed9t ng\xf4n ng\u1eef thu\u1ed9c d\u1ea1ng staticallly typed; khi khai b\xe1o m\u1ed9t bi\u1ebfn b\u1ea5t k\u1ef3, ch\xfang ta ph\u1ea3i x\xe1c \u0111\u1ecbnh \u0111\u01b0\u1ee3c type c\u1ee7a bi\u1ebfn \u0111\xf3. V\xe0 report type error khi c\u1ea7n thi\u1ebft."),(0,r.kt)("li",{parentName:"ul"},"Sau khi ph\xe2n t\xedch xong, ch\xfang ta s\u1ebd l\u01b0u l\u1ea1i nh\u1eefng th\xf4ng tin c\u1ea7n thi\u1ebft \u0111\u1ec3 ph\u1ee5c v\u1ee5 cho c\xe1c giai \u0111o\u1ea1n ti\u1ebfp theo. C\xf3 3 c\xe1ch l\u01b0u ch\xednh nh\u01b0 sau:",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Ch\xe8n ngay v\xe0o ASTs d\u01b0\u1edbi d\u1ea1ng ",(0,r.kt)("em",{parentName:"li"},"attributes")),(0,r.kt)("li",{parentName:"ol"},"L\u01b0u v\xe0o ",(0,r.kt)("a",{parentName:"li",href:"https://www.geeksforgeeks.org/symbol-table-compiler/"},"Symbol Table"),"; th\xf4ng th\u01b0\u1eddng d\xe0nh cho identifiers v\xe0 gi\xe1 tr\u1ecb c\u1ee7a ch\xfang."),(0,r.kt)("li",{parentName:"ol"},"Chuy\u1ec3n h\u1eb3n sang m\u1ed9t c\u1ea5u tr\xfac AST m\u1edbi c\xf3 nhi\u1ec1u th\xf4ng tin h\u01a1n.")))),(0,r.kt)("h4",{id:"notes"},"Notes"),(0,r.kt)("p",null,"3 giai \u0111o\u1ea1n ph\xeda tr\xean \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 ph\u1ea7n front end c\u1ee7a compiler. C\xe1c ph\u1ea7n \u0111\u01b0\u1ee3c tr\xecnh b\xe0y ti\u1ebfp theo \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 back end."),(0,r.kt)("h3",{id:"intermediate-representation"},"Intermediate Representation"),(0,r.kt)("p",null,"C\xf3 th\u1ec3 t\u01b0\u1edfng t\u01b0\u1ee3ng compiler nh\u01b0 m\u1ed9t pipeline, g\u1ed3m 2 giai \u0111o\u1ea1n (phase) l\u1edbn (front end v\xe0 back end) v\xe0 nhi\u1ec1u giai \u0111o\u1ea1n nh\u1ecf. Output c\u1ee7a phase n\xe0y s\u1ebd l\xe0 input c\u1ee7a phase kia."),(0,r.kt)("p",null,"Giai \u0111o\u1ea1n front end t\u1eadp trung ch\u1ee7 y\u1ebfu v\xe0o ph\u1ea7n source code. Giai \u0111o\u1ea1n back end t\u1eadp trung v\xe0o ph\u1ea7n ch\u1ea1y ch\u01b0\u01a1ng tr\xecnh (final architecture where the program will run). \u1ede gi\u1eefa 2 giai \u0111o\u1ea1n \u0111\xf3 th\xec code \u0111\u01b0\u1ee3c l\u01b0u d\u01b0\u1edbi d\u1ea1ng ",(0,r.kt)("em",{parentName:"p"},"intermediate representation(IR)"),". IR s\u1ebd kh\xf4ng g\u1eafn ch\u1eb7t v\u1edbi input (vd: source code) hay output (vd: binary code) c\u1ee7a compiler. C\xf3 th\u1ec3 coi IR nh\u01b0 m\u1ed9t interface gi\u1eefa 2 ng\xf4n ng\u1eef \u0111\xf3."),(0,r.kt)("p",null,"Nh\u1edd v\xe0o IR, m\xe0 ch\xfang ta c\xf3 th\u1ec3 support nhi\u1ec1u runtime m\u1ed9t c\xe1ch d\u1ec5 d\xe0ng: d\xf9ng chung 1 front end, v\xe0 m\u1ed7i runtime kh\xe1c nhau s\u1ebd c\xf3 backend c\u1ee7a ri\xeang n\xf3."),(0,r.kt)("p",null,"V\xed d\u1ee5 nh\u01b0 Kotlin, Scala \u0111\u1ec1u c\xf3 th\u1ec3 ch\u1ea1y tr\xean 3 runtime kh\xe1c nhau: JVM, Javascript, Native. Ho\u1eb7c ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/GNU_Compiler_Collection"},"GCC")," c\xf3 th\u1ec3 bi\xean d\u1ecbch h\xe0ng t\xe1 ng\xf4n ng\u1eef v\xe0 c\xf3 th\u1ec3 target tr\xean d\u01b0\u1edbi 100 architectures kh\xe1c nhau."),(0,r.kt)("p",null,"IR c\xf3 4 styles ch\xednh:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"control flow graph"),(0,r.kt)("li",{parentName:"ul"},"static single-assignment"),(0,r.kt)("li",{parentName:"ul"},"continuation-passing style"),(0,r.kt)("li",{parentName:"ul"},"three-address code")),(0,r.kt)("h3",{id:"optimization"},"Optimization"),(0,r.kt)("p",null,"Sau khi c\xf3 \u0111\u1ee7 hi\u1ec3u bi\u1ebft v\u1ec1 ch\u01b0\u01a1ng tr\xecnh \u0111ang \u0111\u01b0\u1ee3c compile, th\xec ch\xfang ta c\xf3 th\u1ec3 t\u1ed1i \u01b0u n\xf3 b\u1eb1ng c\xe1ch thay ch\u01b0\u01a1ng tr\xecnh n\xe0y b\u1eb1ng m\u1ed9t ch\u01b0\u01a1ng tr\xecnh kh\xe1c c\xf3 c\xf9ng ng\u1eef ngh\u0129a(same semantics - same input same output) nh\u01b0ng hi\u1ec7u qu\u1ea3 h\u01a1n."),(0,r.kt)("p",null,"V\xed d\u1ee5 \u0111\u01a1n gi\u1ea3n nh\u1ea5t l\xe0 ",(0,r.kt)("strong",{parentName:"p"},"constant folding"),", n\u1ebfu m\u1ed9t bi\u1ec3u th\u1ee9c lu\xf4n lu\xf4n cho ra m\u1ed9t k\u1ebft qu\u1ea3 duy nh\u1ea5t; th\xec ch\xfang ta c\xf3 th\u1ec3 d\xf9ng k\u1ebft qu\u1ea3 nh\u1eadn \u0111\u01b0\u1ee3c \u0111\u1ec3 thay th\u1ebf cho bi\u1ec3u th\u1ee9c \u0111\xf3 trong qu\xe1 tr\xecnh compile."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"pennyArea = 3.14159 * (0.75 / 2) * (0.75 / 2);")),(0,r.kt)("p",null,"C\xf3 th\u1ec3 thay th\u1ebf b\u1eb1ng"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"pennyArea = 0.4417860938;")),(0,r.kt)("p",null,"Optimization l\xe0 m\u1ed9t nh\xe1nh l\u1edbn trong m\u1ea3ng programming language, nh\u01b0ng s\u1ebd kh\xf4ng \u0111\u01b0\u1ee3c \u0111i s\xe2u v\xe0o trong quy\u1ec3n s\xe1ch n\xe0y. Sau \u0111\xe2y l\xe0 m\u1ed9t s\u1ed1 keyword \u0111\u1ec3 t\xecm hi\u1ec3u th\xeam v\u1ec1 n\xf3: \u201cconstant propagation\u201d, \u201ccommon subexpression elimination\u201d, \u201cloop invariant code motion\u201d, \u201cglobal value numbering\u201d, \u201cstrength reduction\u201d, \u201cscalar replacement of aggregates\u201d, \u201cdead code elimination\u201d, \u201cloop unrolling\u201d."),(0,r.kt)("h3",{id:"code-generation"},"Code generation"),(0,r.kt)("p",null,"B\u01b0\u1edbc cu\u1ed1i c\xf9ng, sau khi optimization ho\xe0n th\xe0nh, chuy\u1ec3n IR sang m\u1ed9t d\u1ea1ng code m\xe0 m\xe1y c\xf3 th\u1ec3 ch\u1ea1y \u0111\u01b0\u1ee3c. B\u01b0\u1edbc n\xe0y c\xf2n g\u1ecdi l\xe0 ",(0,r.kt)("strong",{parentName:"p"},"Code Generation")," (ho\u1eb7c ",(0,r.kt)("strong",{parentName:"p"},"code gen"),"); Code \u1edf \u0111\xe2y l\xe0 code d\xe0nh cho m\xe1y (vd: d\u1ea1ng assembly ho\u1eb7c byte code tr\xean virtual machine), kh\xf4ng ph\u1ea3i code d\xe0nh ",(0,r.kt)("em",{parentName:"p"},"ng\u01b0\u1eddi")," \u0111\u1ecdc v\xe0 vi\u1ebft."),(0,r.kt)("p",null,"Ch\xfang ta c\xf3 m\u1ed9t s\u1ed1 l\u1ef1a ch\u1ecdn cho ",(0,r.kt)("strong",{parentName:"p"},"code")," \u1edf \u0111\xe2y:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CPU instruction: Code c\xf3 th\u1ec3 ch\u1ea1y c\u1ef1c nhanh, nh\u01b0ng ph\u1ee9c t\u1ea1p v\xe0 t\u1ed1n r\u1ea5t nhi\u1ec1u c\xf4ng \u0111\u1ec3 vi\u1ebft."),(0,r.kt)("li",{parentName:"ul"},"Bytecode ch\u1ea1y tr\xean virtual machine (\u0111\u01b0\u1ee3c g\u1ecdi l\xe0 bytecode v\xec m\u1ed7i instruction \u0111\u1ec1u c\xf3 \u0111\u1ed9 d\xe0i l\xe0 m\u1ed9t byte): C\xf3 th\u1ec3 support nhi\u1ec1u cpu architecture d\u1ec5 d\xe0ng h\u01a1n nh\u01b0ng l\u1ea1i ph\u1ea3i maintain virtual machine v\xe0 t\u1ed1c \u0111\u1ed9 c\xf3 th\u1ec3 kh\xf4ng nhanh b\u1eb1ng c\xe1ch tr\u01b0\u1edbc. (Ch\xfang ta s\u1ebd ch\u1ecdn ph\u01b0\u01a1ng \xe1n n\xe0y)"),(0,r.kt)("li",{parentName:"ul"},"C\u0169ng l\xe0 bytecode nh\u01b0ng thay v\xec d\xf9ng virtual machine, ch\xfang ta s\u1ebd vi\u1ebft m\u1ed9t mini-compiler cho m\u1ed7i m\u1ed9t architecture \u0111\u1ec3 chuy\u1ec3n bytecode sang native code. Hay n\xf3i c\xe1ch kh\xe1c l\xe0 ch\xfang ta s\u1eed d\u1ee5ng bytecode nh\u01b0 m\u1ed9t IR.")),(0,r.kt)("h3",{id:"virtual-machine"},"Virtual machine"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Virtual machine")," (ho\u1eb7c ch\xednh x\xe1c h\u01a1n l\xe0 language virtual machines, g\u1ecdi t\u1eaft l\xe0 VM) l\xe0 m\u1ed9t ch\u01b0\u01a1ng tr\xecnh c\xf3 ch\u1ea1y m\u1ed9t d\u1ea1ng byte code \u1edf runtime. Code ch\u1ea1y tr\xean VM s\u1ebd ch\u1eadm h\u01a1n tr\xean native code nh\u01b0ng c\xf4ng vi\u1ec7c c\u1ee7a compiler s\u1ebd \u0111\u01a1n gi\u1ea3n h\u01a1n. Trong ph\u1ea7n 2 c\u1ee7a quy\u1ec3n s\xe1ch n\xe0y th\xec c\u0169ng ta s\u1ebd implement m\u1ed9t VM b\u1eb1ng C v\xe0 n\xf3 s\u1ebd c\xf3 th\u1ec3 ch\u1ea1y tr\xean t\u1ea5t c\u1ea3 c\xe1c platfrom h\u1ed7 tr\u1ee3 C compiler."),(0,r.kt)("h3",{id:"runtime"},"Runtime"),(0,r.kt)("p",null,"\u1ede \u0111\xe2y ch\xfang ta \u0111\xe3 c\xf3 m\u1ed9t ch\u01b0\u01a1ng tr\xecnh m\xe0 ng\u01b0\u1eddi d\xf9ng c\xf3 th\u1ec3 s\u1eed d\u1ee5ng. B\u01b0\u1edbc cu\u1ed1i c\xf9ng ch\u1ea1y ch\u01b0\u01a1ng tr\xecnh \u0111\xf3. N\u1ebfu ch\xfang ta compiled th\xe0nh native code, th\xec operating system s\u1ebd t\u1ea3i ch\u01b0\u01a1ng tr\xecnh v\xe0 ch\u1ea1y n\xf3, n\u1ebfu compiled th\xe0nh bytecode th\xec ch\xfang ta c\u1ea7n kh\u1edfi \u0111\u1ed9ng VM r\u1ed3i t\u1ea3i ch\u01b0\u01a1ng tr\xecnh tr\xean c\xe1i VM \u0111\xf3."),(0,r.kt)("p",null,"Trong c\u1ea3 2 tr\u01b0\u1eddng h\u1ee3p \u0111\xf3 ch\xfang ta v\u1eabn c\u1ea7n ph\u1ea3i m\u1ed9t s\u1ed1 services ch\u1ea1y ng\u1ea7m \u0111\u1ec3 nh\u1ee9:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Qu\u1ea3n l\xfd memory/gabarge collector"),(0,r.kt)("li",{parentName:"ul"},"N\u1ebfu language h\u1ed7 tr\u1ee3 runtim checking (vd: ",(0,r.kt)("inlineCode",{parentName:"li"},"instance of"),"), ch\xfang ta c\u1ea7n n\u1eafm \u0111\u01b0\u1ee3c type c\u1ee7a t\u1eebng object trong c\u1ea3 qu\xe1 tr\xecnh th\u1ef1c thi.")),(0,r.kt)("p",null,"T\u1ea5t c\u1ea3 nh\u1eefng th\u1ee9 \u0111\xf3 \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n trong l\xfac ch\u1ea1y ch\u01b0\u01a1ng tr\xecnh n\xean \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 runtime."),(0,r.kt)("p",null,"\u1ede nh\u1eefng ng\xf4n ng\u1eef \u0111\u01b0\u1ee3c compile ho\xe0n to\xe0n th\xe0nh native code, th\xec runtime \u0111\u01b0\u1ee3c \u0111\xednh k\xe8m lu\xf4n v\xe0o ch\u01b0\u01a1ng tr\xecnh (vd nh\u01b0 Golang)."),(0,r.kt)("p",null,"N\u1ebfu m\u1ed9t ng\xf4n ng\u1eef \u0111\u01b0\u1ee3c ch\u1ea1y trong m\u1ed9t interpreter ho\u1eb7c VM th\xec runtime l\xe0 m\u1ed9t ph\u1ea7n c\u1ee7a interpreter/VM. \u0110a ph\u1ea7n c\xe1c ng\xf4n ng\u1eef \u0111\u01b0\u1ee3c implement d\u01b0\u1edbi d\u1ea1ng n\xe0y: Java, Python, Javascript."),(0,r.kt)("h2",{id:"shortcut-and-alternative-routes"},"Shortcut and alternative routes"),(0,r.kt)("p",null,"Ph\u1ea7n tr\xean \u0111\xe3 m\xf4 t\u1ea3 t\u1ea5t c\u1ea3 c\xe1c b\u01b0\u1edbc m\xe0 ch\xfang ta c\xf3 th\u1ec3 ph\u1ea3i implement. R\u1ea5t nhi\u1ec1u ng\xf4n ng\u1eef \u0111\u01b0\u1ee3c vi\u1ebft v\u1edbi \u0111\u1ea7y \u0111\u1ee7 c\xe1c b\u01b0\u1edbc \u0111\xf3, nh\u01b0ng c\u0169ng c\xf3 m\u1ed9t s\u1ed1 con \u0111\u01b0\u1eddng t\u1eaft v\xe0 thay th\u1ebf."),(0,r.kt)("h3",{id:"single-pass-compilers"},"Single-pass compilers"),(0,r.kt)("p",null,"C\xf3 m\u1ed9t s\u1ed1 compiler g\u1ed9p parsing, analysis v\xe0 code generation l\u1ea1i l\xe0m m\u1ed9t, th\xe0nh ra output code \u0111\u01b0\u1ee3c tr\u1ef1c ti\u1ebfp t\u1ea1o ra t\u1eeb parser. Ch\xfang kh\xf4ng s\u1eed d\u1ee5ng ASTs c\u0169ng nh\u01b0 IRs trong qu\xe1 tr\xecnh bi\xean d\u1ecbch. Ch\xfang \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 ",(0,r.kt)("strong",{parentName:"p"},"single-pass compilers"),"."),(0,r.kt)("p",null,"Nh\u1eefng ",(0,r.kt)("strong",{parentName:"p"},"single-pass compilers")," n\xe0y s\u1ebd c\xf3 nhi\u1ec1u gi\u1edbi h\u1ea1n:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Kh\xf4ng c\xf3 m\u1ed9t c\u1ea5u tr\xfac d\u1eef li\u1ec7u trung gian \u0111\u1ec3 l\u01b0u l\u1ea1i global information"),(0,r.kt)("li",{parentName:"ul"},"Kh\xf4ng th\u1ec3 quay l\u1ea1i c\xe1c ph\u1ea7n tr\u01b0\u1edbc c\u1ee7a ch\u01b0\u01a1ng tr\xecnh. Ngh\u0129a l\xe0 khi compiler th\u1ea5y m\u1ed9t bi\u1ec3u th\u1ee9c n\xe0o \u0111\xf3 th\xec n\xf3 ph\u1ea3i c\xf3 kh\u1ea3 n\u0103ng bi\xean d\u1ecbch bi\u1ec3u th\u1ee9c \u0111\xf3 ngay.")),(0,r.kt)("p",null,"Pascal v\xe0 C c\xf3 chung nh\u1eefng c\xe1i \u0111i\u1ec3m y\u1ebfu n\xe0y, \u0111\xf3 l\xe0 l\xfd do t\u1ea1i sao Pascal y\xeau c\u1ea7u ph\u1ea3i khai b\xe1o ki\u1ec3u c\u1ee7a bi\u1ebfn \u1edf \u0111\u1ea7u file; c\u0169ng nh\u01b0 v\u1edbi C ta kh\xf4ng th\u1ec3 g\u1ecdi m\u1ed9t function tr\u01b0\u1edbc khi n\xf3 \u0111\u01b0\u1ee3c khai b\xe1o (tr\u1eeb khi ta khai b\xe1o function \u0111\xf3 v\u1edbi forward declaration)."),(0,r.kt)("h3",{id:"tree-walk-interpreters"},"Tree-walk interpreters"),(0,r.kt)("p",null,"L\xe0 nh\u1eefng ng\xf4n ng\u1eef \u0111\u01b0\u1ee3c th\u1ef1c thi sau khi c\xf3 AST (c\xf3 th\u1ec3 c\xf3 th\xeam m\u1ed9t \xedt static analysis). \u0110\u1ec3 th\u1ef1c thi ch\u01b0\u01a1ng tr\xecnh, intepreter duy\u1ec7t t\u1eebng node c\u1ee7a AST, thay th\u1ebf d\u1ea7n d\u1ea7n c\xe1c node b\u1eb1ng k\u1ebft qu\u1ea3 t\xednh \u0111\u01b0\u1ee3c \u0111\u1ebfn t\u1eadn c\xf9ng. \u0110\xe2y c\u0169ng l\xe0 c\xe1ch ch\xfang ta implement interpreter \u0111\u1ea7u ti\xean."),(0,r.kt)("p",null,"Notes: Nh\u1eefng phi\xean b\u1ea3n \u0111\u1ea7u ti\xean c\u1ee7a Ruby \u0111\u01b0\u1ee3c implement d\u01b0\u1edbi d\u1ea1ng n\xe0y."),(0,r.kt)("h3",{id:"transpiler"},"Transpiler"),(0,r.kt)("p",null,"Kh\xe1 l\xe0 ph\u1ed5 bi\u1ebfn hi\u1ec7n nay, \u0111\u1eb7c bi\u1ec7t v\u1edbi javascript l\xe0 ng\xf4n ng\u1eef m\u1ee5c ti\xeau. Transpiler l\xe0 m\u1ed9t compiler bi\xean d\u1ecbch code t\u1eeb ng\xf4n ng\u1eef n\xe0y sang m\u1ed9t ng\xf4n ng\u1eef kh\xe1c, th\u01b0\u1eddng t\u1eeb b\u1eadc cao (higher level) sang b\u1eadc th\u1ea5p h\u01a1n (lower level)."),(0,r.kt)("p",null,"Ph\u1ea7n front end c\u1ee7a nh\u1eefng compiler n\xe0y th\xec gi\u1ed1ng h\u1ec7t c\xe1c compiler kh\xe1c. Sau \u0111\xf3 tu\u1ef3 thu\u1ed9c v\xe0o s\u1ef1 kh\xe1c nhau gi\u1eefa hai ng\xf4n ng\u1eef, implementation c\u1ee7a back end c\xf3 th\u1ec3 r\u1ea5t kh\xe1c nhau. T\u1eeb \u0111\u01a1n gi\u1ea3n chuy\u1ec3n th\u1eb3ng t\u1eeb AST sang target language ho\u1eb7c bao g\u1ed3m t\u1ea5t c\u1ea3 c\xe1c b\u01b0\u1edbc k\u1ec3 tr\xean."),(0,r.kt)("h3",{id:"just-in-time-compilation"},"Just-in-time compilation"),(0,r.kt)("p",null,"C\xe1ch nhanh nh\u1ea5t \u0111\u1ec3 th\u1ef1c thi code \u0111\xf3 l\xe0 bi\xean d\u1ecbch n\xf3 th\xe0nh native code. Nh\u01b0ng khi bi\xean d\u1ecbch th\xec ch\xfang ta kh\xf4ng bi\u1ebft \u0111\u01b0\u1ee3c n\xf3 s\u1ebd \u0111\u01b0\u1ee3c ch\u1ea1y v\u1edbi ki\u1ec3u architecture n\xe0o. Just-in-time (JIT) l\xe0 m\u1ed9t k\u1ef9 thu\u1eadt cao c\u1ea5p \u0111\u01b0\u1ee3c \u0111\u1ec3 t\u1ed1i \u01b0u ho\xe1 t\u1ed1c \u0111\u1ed9c c\u1ee7a ch\u01b0\u01a1ng tr\xecnh trong tr\u01b0\u1eddng h\u1ee3p n\xe0y. JIT \u0111\u01b0\u1ee3c s\u1ef1 d\u1ee5ng b\u1edfi Hotspot Java Virtual Machine (JVM), Microsoft's Common Language Runtime (CLR) v\xe0 \u0111a s\u1ed1 c\xe1c tr\xecnh bi\xean d\u1ecbch c\u1ee7a Javascript."),(0,r.kt)("p",null,"Khi ch\u01b0\u01a1ng tr\xecnh \u0111\u01b0\u1ee3c t\u1ea3i l\xean - t\u1eeb source trong tr\u01b0\u1eddng h\u1ee3p c\u1ee7a Javascript hay t\u1eeb bytecode nh\u01b0 c\u1ee7a JVM/CLR - th\xec JIT s\u1ebd compile n\xf3 th\xe0nh native code ngay l\xfac \u0111\xf3."),(0,r.kt)("h2",{id:"compilers-vs-interpreters"},"Compilers vs Interpreters"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Compiling (bi\xean d\u1ecbch) l\xe0 qu\xe1 tr\xecnh chuy\u1ec3n \u0111\u1ed5i t\u1eeb m\u1ed9t ng\xf4n ng\u1eef l\u1eadp tr\xecnh sang m\u1ed9t d\u1ea1ng m\u1edbi: bytecode ho\u1eb7c native code ho\u1eb7c m\u1ed9t ng\xf4n ng\u1eef kh\xe1c."),(0,r.kt)("li",{parentName:"ul"},"Compiler th\xec ch\u1ec9 c\xf3 nhi\u1ec7m v\u1ee5 bi\xean d\u1ecbch"),(0,r.kt)("li",{parentName:"ul"},"Intepreter th\xec c\xf3 kh\u1ea3 n\u0103ng th\u1ef1c thi ch\u01b0\u1eddng tr\xecnh t\u1eeb source code.")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/LLvek2X.png",alt:"venn"})))}g.isMDXComponent=!0}}]);